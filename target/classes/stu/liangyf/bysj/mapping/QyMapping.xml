<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="stu.liangyf.bysj.dao.QyDao">




	<select id="getQyjbxxByQyid" resultType="stu.liangyf.bysj.entity.QyjbxxEntity">
		SELECT
		q.qyid,
		q.qymc,
		q.qyyx,
		q.qylxdh,
		q.qygm,
		q.qyxz,
		q.qyhy,
		q.qydz,
		q.qyjs
		from qyjbxx q
		where
		q.qyid = #{0}
	</select>

	<select id="listGwypxxByQyid" resultType="stu.liangyf.bysj.entity.GwjbxxEntity"
		parameterType="hashmap">
		select * from (
		SELECT
		*
		FROM
		(
		SELECT
		g.gwid,
		g.gwmc,
		g.gwzprs,
		count(x.xsid) yprs
		FROM
		gwjbxx g,
		xsypb x
		WHERE
		g.gwid = x.gwid
		AND g.gwyxbz = 'Y'
		AND g.gwfbqyid = #{qyid}
		GROUP BY
		g.gwid,
		g.gwmc,
		g.gwzprs
		) a
		UNION ALL
		SELECT
		g.gwid,
		g.gwmc,
		g.gwzprs,
		0 yprs
		FROM
		gwjbxx g
		WHERE
		g.gwyxbz = 'Y'
		AND g.gwfbqyid = #{qyid}
		AND NOT EXISTS (
		SELECT
		1
		FROM
		xsypb x
		WHERE
		g.gwid = x.gwid
		)
		) b order by b.yprs desc
		LIMIT
		#{offset} ,#{limit}
	</select>

	<select id="countGwypxxByQyid" resultType="java.lang.Integer"
		parameterType="hashmap">
		SELECT
		count(distinct g.gwid )
		from gwjbxx g where
		g.gwfbqyid = #{qyid}
		and g.gwyxbz = 'Y'
	</select>

	<select id="listGwypxsxxByGwid" resultType="stu.liangyf.bysj.entity.XsypxxEntity"
		parameterType="hashmap">
		SELECT
		t.tdjlsj,
		x.xsid,
		x.xsxm,
		x.xsxl,
		t.dqzt,
		s.school_name,
		CASE
		WHEN x.xsxl = '1' THEN
		'大专'
		WHEN x.xsxl = '2' THEN
		'本科'
		WHEN x.xsxl = '3' THEN
		'硕士'
		WHEN x.xsxl = '4' THEN
		'博士'
		END xsxlmc
		FROM
		xsypb t,
		xsjbxx x,
		school s
		WHERE
		t.xsid = x.xsid
		AND x.xsszxxid = s.id
		AND t.gwid = #{gwid}
		LIMIT #{offset} ,#{limit}
	</select>

	<select id="countGwypxsxxByGwid" resultType="java.lang.Integer"
		parameterType="hashmap">
		SELECT
		count(*)
		FROM
		xsypb t
		WHERE
		t.gwid = #{gwid}
	</select>

	<insert id="insertGwjbxx" parameterType="stu.liangyf.bysj.entity.GwjbxxEntity">
		INSERT INTO gwjbxx (
		gwid,
		gwfbqyid,
		gwdy,
		gwfbrq,
		gwgzdd,
		gwlbid,
		gwmc,
		gwms,
		gwyx,
		gwzprs,
		gwyxbz
		)
		VALUES
		(#{gwid},#{gwfbqyid},#{gwdy},now(),#{gwgzdd},#{gwlbid},#{gwmc},#{gwms},#{gwyx},#{gwzprs},'Y')
	</insert>

	<update id="updateGwjbxx" parameterType="stu.liangyf.bysj.entity.GwjbxxEntity">
		UPDATE
		gwjbxx g
		SET
		g.gwlbid = #{gwlbid}
		,g.gwmc = #{gwmc}
		,g.gwyx = #{gwyx}
		,g.gwzprs =
		#{gwzprs}
		,g.gwdy = #{gwdy}
		,g.gwgzdd = #{gwgzdd}
		,g.gwms = #{gwms}
		where
		g.gwid = #{gwid}
	</update>

	<update id="updateQyjbxx" parameterType="stu.liangyf.bysj.entity.QyjbxxEntity">
		UPDATE
		qyjbxx q
		set q.qymc
		= #{qymc}
		,q.qyyx = #{qyyx}
		,q.qylxdh = #{qylxdh}
		,q.qygm = #{qygm}
		,q.qyhy = #{qyhy}
		,q.qydz = #{qydz}
		,q.qyjs = #{qyjs}
		where q.qyid =
		#{qyid}
	</update>

	<update id="deleteQygw">
		UPDATE
		gwjbxx t
		set t.gwyxbz = 'N'
		where t.gwid = #{0}
	</update>

	<update id="updateXsypzt" parameterType="hashmap">
		update
		xsypb t
		set t.dqzt
		= #{dqzt}
		where t.gwid = #{gwid} and t.xsid = #{xsid}
	</update>

	<update id="updateQydlmm">
		update
		qyjbxx q
		set q.qydlmm = #{0}
		where q.qyyx = #{1} and q.qydlmm = #{2}
	</update>
</mapper>